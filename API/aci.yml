apiVersion: '2021-07-01'
location: francecentral
name: callforcode-${{ env.CLEAN_BRANCH_NAME }}

properties:
  containers:
    - name: nginx
      properties:
        image: callforcodeacr.azurecr.io/nginx:${{ github.sha }}
        ports:
          - port: 8080
    - name: contribute
      properties:
        image: callforcodeacr.azurecr.io/contribute:${{ github.sha }}
        ports:
          - port: 8001
    - name: data
      properties:
        image: callforcodeacr.azurecr.io/data:${{ github.sha }}
        ports:
          - port: 8003
    - name: generator
      properties:
        image: callforcodeacr.azurecr.io/generator:${{ github.sha }}
        ports:
          - port: 8004
    - name: maps
      properties:
        image: callforcodeacr.azurecr.io/maps:${{ github.sha }}
        ports:
          - port: 8005
    - name: traitement
      properties:
        image: callforcodeacr.azurecr.io/traitement:${{ github.sha }}
        ports:
          - port: 8006
  osType: Linux
  ipAddress:
    type: Public
    dnsNameLabel: callforcode-${{ env.CLEAN_BRANCH_NAME }}
    ports:
      - protocol: TCP
        port: 8080
      - protocol: TCP
        port: 8001
      - protocol: TCP
        port: 8003
      - protocol: TCP
        port: 8004
      - protocol: TCP
        port: 8005
      - protocol: TCP
        port: 8006
  restartPolicy: Always
  imageRegistryCredentials:
    - server: callforcodeacr.azurecr.io
      username: ${{ secrets.AZURE_ACR_USERNAME }}
      password: ${{ secrets.AZURE_ACR_PASSWORD }}
